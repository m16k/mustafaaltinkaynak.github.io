<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Mustafa ALTINKAYNAK - [SLACK] Nagios Entegrasyonu</title>
        <meta name="description" content="" />

        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="shortcut icon" href="http://localhost:8000/assets/images/favicon.png">
        <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/custom.css"/>
        <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/pygments.css"/>
        <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/css/monosocialiconsfont.css"/>
        <link rel="stylesheet" href="http://localhost:8000/theme/tipuesearch/tipuesearch.css">
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300&subset=latin,latin-ext' rel='stylesheet' type='text/css'>

        <link href="http://localhost:8000/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Mustafa ALTINKAYNAK Full Atom Feed" />
        <link href="http://localhost:8000/feeds/all.rss" type="application/rss+xml" rel="alternate" title="Mustafa ALTINKAYNAK Full RSS Feed" />
        <link href="http://localhost:8000/feeds/sistem-yoneticiligi.atom.xml" type="application/atom+xml" rel="alternate" title="Mustafa ALTINKAYNAK Categories Atom Feed" />

    </head>
    <body class="home-template">
        <div class="container">
            <div class="col-md-10 col-md-offset-1 col-sm-12 col-xs-12">
<main class="content" role="main">
    <div class="row">
        <article class="post tag-play tag-security">
          <header class="post-header">
            <a class="blog-logo" href="/">
              <span class="blog-title">Mustafa ALTINKAYNAK</span>
            </a>
          </header>
           
            <h1 class="post-title">[SLACK] Nagios Entegrasyonu</h1>


            <section class="post-content">
              <p><strong>Nagios</strong> ağ üzerinde bulunan sistemleri monitör etmek için kullanılan bir yazılımdır. Yazılım sayesinde tüm aktif cihazlarını sizlere sunmuş olduğu arayüz üzerinden monitör edebilirsiniz. Nagios ile birlikte makinalara farklı görev tanımları gerçekleştirebilir ve durum maili alabilirsiniz. <a href="https://www.nagios.org">Buraya</a> tıklayarak Nagios'a ulaşabilirsiniz.</p>
<h2>Slack Nagios Entegrasyonu</h2>
<p><a href="https://my.slack.com/services/new/nagios">https://my.slack.com/services/new/nagios</a> adresinde yer alan <strong>"Add Nagios integration"</strong> kısmı içerisinde yer alan <strong>Setup Instructions</strong> başlığı altında kurulum talimatlarına ulaşabilirsiniz. Sizler için takımınıza ait kanal ismi ve token bilgisi dinamik olarak üretilecektir.</p>
<div class="highlight"><pre><span class="code-line"><span class="n">wget</span> <span class="n">https</span><span class="o">:</span><span class="c1">//raw.github.com/tinyspeck/services-examples/master/nagios.pl</span></span>
<span class="code-line"><span class="n">cp</span> <span class="n">nagios</span><span class="p">.</span><span class="n">pl</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">slack_nagios</span><span class="p">.</span><span class="n">pl</span></span>
<span class="code-line"><span class="n">chmod</span> <span class="mi">755</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">slack_nagios</span><span class="p">.</span><span class="n">pl</span></span>
</pre></div>


<p>slack_nagios.pl dosyası içerisinde bizlere özel teamname ve token bilgisini düzenleyelim.</p>
<div class="highlight"><pre><span class="code-line"><span class="k">my</span> <span class="nv">$opt_domain</span> <span class="o">=</span> <span class="s">&quot;teamname.slack.com&quot;</span><span class="p">;</span> <span class="c1"># Your team&#39;s domain</span></span>
<span class="code-line"><span class="k">my</span> <span class="nv">$opt_token</span> <span class="o">=</span> <span class="s">&quot;token&quot;</span><span class="p">;</span> <span class="c1"># The token from your Nagios services page</span></span>
</pre></div>


<p>Nagios bildirimlerin kimlere gönderileceği dair yapılandırma ayarlarını <strong>/etc/nagios3/conf.d/contacts_nagios2.cfg</strong> dosyasında tutmaktadır.</p>
<div class="highlight"><pre><span class="code-line"><span class="n">define</span> <span class="n">contact</span> <span class="p">{</span></span>
<span class="code-line">      <span class="n">contact_name</span>                             <span class="n">slack</span></span>
<span class="code-line">      <span class="n">alias</span>                                    <span class="n">Slack</span></span>
<span class="code-line">      <span class="n">service_notification_period</span>              <span class="mi">24</span><span class="n">x7</span></span>
<span class="code-line">      <span class="n">host_notification_period</span>                 <span class="mi">24</span><span class="n">x7</span></span>
<span class="code-line">      <span class="n">service_notification_options</span>             <span class="n">w</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">r</span></span>
<span class="code-line">      <span class="n">host_notification_options</span>                <span class="n">d</span><span class="p">,</span><span class="n">r</span></span>
<span class="code-line">      <span class="n">service_notification_commands</span>            <span class="n">notify</span><span class="o">-</span><span class="n">service</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="n">slack</span></span>
<span class="code-line">      <span class="n">host_notification_commands</span>               <span class="n">notify</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="n">slack</span></span>
<span class="code-line"><span class="p">}</span></span>
</pre></div>


<p>Yukarıdaki contact tanımlaması ile birlikte yeni bir bildirim türü belirledik.</p>
<h2>Service Notification Options parametreleri</h2>
<table>
<thead>
<tr>
<th>Parametre</th>
<th>Açıklama</th>
</tr>
</thead>
<tbody>
<tr>
<td>w</td>
<td>Warning durumlarında bildirim gönderir.</td>
</tr>
<tr>
<td>u</td>
<td>Unknown durumlarında bildirim gönderir.</td>
</tr>
<tr>
<td>c</td>
<td>Kritik durumlarda bildirim gönderir.</td>
</tr>
<tr>
<td>r</td>
<td>Servisin tekrar ayağa kalkma durumunda bildirim gönderir.</td>
</tr>
<tr>
<td>f</td>
<td>Servisin start/stop durum analizini gönderir.</td>
</tr>
<tr>
<td>s</td>
<td>Zamanlanmış aralıklarda bildirim gönderir.</td>
</tr>
</tbody>
</table>
<h2>Host Notification Options parametreleri</h2>
<table>
<thead>
<tr>
<th>Parametre</th>
<th>Açıklama</th>
</tr>
</thead>
<tbody>
<tr>
<td>d</td>
<td>Hostun down olması durumunda bildirim gönderir.</td>
</tr>
<tr>
<td>u</td>
<td>Hostun UNREACHABLE olduğu durumlarda bildirim gönderir.</td>
</tr>
<tr>
<td>r</td>
<td>Hostun tekrar ayağa kalkma durumunda bildirim gönderir.</td>
</tr>
<tr>
<td>f</td>
<td>Hostun start/stop durum analizini gönderir.</td>
</tr>
<tr>
<td>s</td>
<td>Zamanlanmış aralıklarda bildirim gönderir.</td>
</tr>
</tbody>
</table>
<h2>Nagios bildirim komutlarını tanımlayalım</h2>
<p>Contact profilini tanımlarken service_notification_commands ve host_notification_commands parametrelerini kullanmıştım. Şimdi <strong>commands.cfg</strong> dosyası içerisinde bu komutlarını tanımlayalım. Bu dosyayı "/etc/nagios3/commands.cfg" adresinden ulaşabilirsiniz.</p>
<div class="highlight"><pre><span class="code-line"><span class="n">define</span> <span class="n">command</span> <span class="p">{</span></span>
<span class="code-line">      <span class="n">command_name</span> <span class="n">notify</span><span class="o">-</span><span class="n">service</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="n">slack</span></span>
<span class="code-line">      <span class="n">command_line</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">slack_nagios</span><span class="p">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">field</span> <span class="n">slack_channel</span><span class="o">=</span><span class="err">#</span><span class="n">nagios</span> <span class="o">-</span><span class="n">field</span> <span class="n">HOSTALIAS</span><span class="o">=</span><span class="s">&quot;$HOSTNAME$&quot;</span> <span class="o">-</span><span class="n">field</span> <span class="n">SERVICEDESC</span><span class="o">=</span><span class="s">&quot;$SERVICEDESC$&quot;</span> <span class="o">-</span><span class="n">field</span> <span class="n">SERVICESTATE</span><span class="o">=</span><span class="s">&quot;$SERVICESTATE$&quot;</span> <span class="o">-</span><span class="n">field</span> <span class="n">SERVICEOUTPUT</span><span class="o">=</span><span class="s">&quot;$SERVICEOUTPUT$&quot;</span> <span class="o">-</span><span class="n">field</span> <span class="n">NOTIFICATIONTYPE</span><span class="o">=</span><span class="s">&quot;$NOTIFICATIONTYPE$&quot;</span></span>
<span class="code-line"><span class="p">}</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="n">define</span> <span class="n">command</span> <span class="p">{</span></span>
<span class="code-line">      <span class="n">command_name</span> <span class="n">notify</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="n">slack</span></span>
<span class="code-line">      <span class="n">command_line</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">slack_nagios</span><span class="p">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">field</span> <span class="n">slack_channel</span><span class="o">=</span><span class="err">#</span><span class="n">nagios</span> <span class="o">-</span><span class="n">field</span> <span class="n">HOSTALIAS</span><span class="o">=</span><span class="s">&quot;$HOSTNAME$&quot;</span> <span class="o">-</span><span class="n">field</span> <span class="n">HOSTSTATE</span><span class="o">=</span><span class="s">&quot;$HOSTSTATE$&quot;</span> <span class="o">-</span><span class="n">field</span> <span class="n">HOSTOUTPUT</span><span class="o">=</span><span class="s">&quot;$HOSTOUTPUT$&quot;</span> <span class="o">-</span><span class="n">field</span> <span class="n">NOTIFICATIONTYPE</span><span class="o">=</span><span class="s">&quot;$NOTIFICATIONTYPE$&quot;</span></span>
<span class="code-line"><span class="p">}</span></span>
</pre></div>


<p>Ben Nagios üzerine MySQL server kontrolünü de eklemiştim. Şimdi MySQL servisimizi durduralım. 18:34:36'da MySQL servisi durdurdum.</p>
<p><img alt="" src="assets/images/mysql_stop.png" /></p>
<p>18:35:19'da da Nagios MySQL servisine erişemediğine dair bildirimi göndermiş.
<img alt="" src="assets/images/nagios_alert.png" /></p>
<p>Aynı esnada cep telefonuma da bildirim geldi.
<img alt="" src="assets/images/slack_android.png" /></p>
            </section>

            <footer class="post-footer">
                <section>
                  <span class="post-meta">
                    Tags:                   </span>
                </section>

                <section class="share">
                    <h4>Share this post</h4>
                    <a class="icon-twitter" href="http://twitter.com/share?text=[SLACK] Nagios Entegrasyonu&url=http://localhost:8000/slack-nagios-entegrasyonu.html"
                        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                        <span class="hidden">Twitter</span>
                        <span class='symbol'>circletwitterbird</span>
                    </a>
                    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:8000/slack-nagios-entegrasyonu.html"
                        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                        <span class="hidden">Facebook</span>
                        <span class='symbol'>circlefacebook</span>
                    </a>
                    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://localhost:8000/slack-nagios-entegrasyonu.html"
                       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                        <span class="hidden">Google+</span>
                        <span class='symbol'>circlegoogleplus</span>
                    </a>
                </section>

            </footer>

            <div id="disqus_thread"></div>
            <script>
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//mustafaaltinkaynak.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        </article>
    </div>
</main>
                <footer class="site-footer">
                    <a class="subscribe icon-feed" href="http://localhost:8000/feeds/all.rss"><span class="tooltip"><span class="symbol">blip</span></span></a>
                    <a class="subscribe icon-feed" href="http://localhost:8000/archives.html"><span class="tooltip"><span class="symbol">star</span></span></a>
                    <div class="inner">
                         <section class="copyright">mustafaaltinkaynak &copy; 2015</section>
                    </div>
                </footer>

                <!-- Yandex.Metrika counter -->
                <script type="text/javascript">
                    (function (d, w, c) {
                        (w[c] = w[c] || []).push(function() {
                            try {
                                w.yaCounter39549065 = new Ya.Metrika({
                                    id:39549065,
                                    clickmap:true,
                                    trackLinks:true,
                                    accurateTrackBounce:true
                                });
                            } catch(e) { }
                        });

                        var n = d.getElementsByTagName("script")[0],
                            s = d.createElement("script"),
                            f = function () { n.parentNode.insertBefore(s, n); };
                        s.type = "text/javascript";
                        s.async = true;
                        s.src = "https://mc.yandex.ru/metrika/watch.js";

                        if (w.opera == "[object Opera]") {
                            d.addEventListener("DOMContentLoaded", f, false);
                        } else { f(); }
                    })(document, window, "yandex_metrika_callbacks");
                </script>
                <noscript><div><img src="https://mc.yandex.ru/watch/39549065" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
                <!-- /Yandex.Metrika counter -->


            </div>
        </div>
    </body>
</html>