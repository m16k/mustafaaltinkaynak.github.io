<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Mustafa ALTINKAYNAK - [SLACK] SSH Girişlerini Bildirim Olarak Almak</title>
        <meta name="description" content="" />

        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="shortcut icon" href="https://www.mustafa.com.tr/assets/images/favicon.png">
        <link rel="stylesheet" type="text/css" href="https://www.mustafa.com.tr/theme/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="https://www.mustafa.com.tr/theme/css/custom.css"/>
        <link rel="stylesheet" type="text/css" href="https://www.mustafa.com.tr/theme/css/pygments.css"/>
        <link rel="stylesheet" type="text/css" href="https://www.mustafa.com.tr/theme/css/monosocialiconsfont.css"/>
        <link rel="stylesheet" href="https://www.mustafa.com.tr/theme/tipuesearch/tipuesearch.css">
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300&subset=latin,latin-ext' rel='stylesheet' type='text/css'>

        <link href="https://www.mustafa.com.tr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Mustafa ALTINKAYNAK Full Atom Feed" />
        <link href="https://www.mustafa.com.tr/feeds/all.rss" type="application/rss+xml" rel="alternate" title="Mustafa ALTINKAYNAK Full RSS Feed" />
        <link href="https://www.mustafa.com.tr/feeds/sistem-yoneticiligi.atom.xml" type="application/atom+xml" rel="alternate" title="Mustafa ALTINKAYNAK Categories Atom Feed" />

    </head>
    <body class="home-template">
        <div class="container">
            <div class="col-md-10 col-md-offset-1 col-sm-12 col-xs-12">
<main class="content" role="main">
    <div class="row">
        <article class="post tag-play tag-security">
          <header class="post-header">
            <a class="blog-logo" href="/">
              <span class="blog-title">Mustafa ALTINKAYNAK</span>
            </a>
          </header>
           
            <h1 class="post-title">[SLACK] SSH Girişlerini Bildirim Olarak Almak</h1>


            <section class="post-content">
              <p>Merhabalar.
Bu yazımızda daha çok geliştirici ekiplerinin kullandığı ekip içi yazışma ortamı sağlayan Slack ile ilgili çalışma gerçekleştireceğiz.
Artık ekip içi yazışmalarınızı, iş atamalarınızı (busybot) Slack üzerinden yaptığınıza göre fazlalıklardan kurtulmak isteyebilirsiniz. Şahsen ben çok fazla ortam kullanmayı tercih etmek yerine, tek yerden bir dashboard mantığında herşeyi görebilmek isterim. Kısa bir girizgahından ardından giriş yapalım.</p>
<p>Slack'de çoğu uygulama gibi webhook yapısına uygun tasarlanmıştır. Webhook farklı uygulamaların birbirleri ile entegrasyon sağlayabilmeleri için Uygulama içerisinde oluşan event'leri HTTP üzerinden JSON Payload'ları ile kendilerine subscribe olan diğer uygulamaları tetiklemesidir. Tabii bu işlemi yapabilmeniz için webhook izinlerini sağlamanız gerekmektedir.</p>
<h2>Slack için token oluşturalım.</h2>
<p><a href="https://api.slack.com/incoming-webhooks">Buraya</a> tıklayarak <strong>Integration Settings</strong> alanından yapılandırma ayarlarına ulaşabilirsiniz.</p>
<p><strong>Post to Channel:</strong> Gönderim yapacağınız kanal</p>
<p><strong>Webhook URL :</strong> Kanalı seçmeniz ardından bu URL dinamik olarak oluşacaktır. Bu URL'yi sonra ki aşamalarda kullanacağımızdan dolayı saklamanız gerekmektedir.</p>
<p><strong>Descriptive Label:</strong> Dilerseniz opsiyonel olarak açıklama etiketi girebilirsiniz.</p>
<p><strong>Customize Name:</strong> Gelen bildirimlerde yer alan kullanıcı adını seçebilirsiniz.</p>
<p><strong>Customize Icon:</strong> Gelen bildirimlerde yer alan iconu değiştirebilirsiniz.</p>
<p><strong>Preview Message:</strong> Bu alandan da gelecek bildirimi önizleme olarak görebilirsiniz.</p>
<p>Ayarları <strong>"Save Settings"</strong> butonu ile birlikte kaydediyoruz.</p>
<h2>SSH ile yapılan girişlerde bildirim gelmesini sağlayalım.</h2>
<p><strong>/etc/profile</strong> dosyasını editör ile açtıktan sonra en alt kısmına aşağıdaki kod blogunu ekleyebilirsiniz. <strong>"WEBHOOK_URL"</strong> alanını yukarıda saklamanızı istediğim alanla değiştirmeyi unutmayınız.</p>
<div class="highlight"><pre><span class="code-line">    if [ -n &quot;<span class="nv">$SSH_CLIENT</span>&quot; ]; then</span>
<span class="code-line">      TEXT=&quot;$(date): ssh login to <span class="cp">${</span><span class="n">USER</span><span class="cp">}</span>@$(hostname -f)&quot;</span>
<span class="code-line">      TEXT=&quot;<span class="nv">$TEXT</span> from $(echo <span class="nv">$SSH_CLIENT</span>|awk &#39;{print $1}&#39;)&quot;</span>
<span class="code-line">      curl -X POST \</span>
<span class="code-line">      --data-urlencode &quot;payload={\&quot;username\&quot;: \&quot;SSH Login Alerts\&quot;, \&quot;text\&quot;: \&quot;<span class="cp">${</span><span class="n">TEXT</span><span class="cp">}</span>\&quot;}&quot; \</span>
<span class="code-line">      WEBHOOK_URL <span class="err">&amp;</span>&gt;/dev/null <span class="err">&amp;</span></span>
<span class="code-line">    fi</span>
</pre></div>


<p>Yukarıdaki kod blogunu açıklamak gerekirse, sadece SSH işlemlerinde çalışacak şekilde ayarlanmıştır. date parametresinde zaman damgası, $USER bağlantıyı gerçekleştiren kullanıcı, $hostname ise bağlantı yapılan makina adını içerir. $SSH_CLIENT ise bağlantıyı gerçekleştiren kullanıcının IP adresini içerir ve bu AWK ile sadeleştirilmiştir. Akabinde curl ile birlikte POST isteği gerçekleştiriyoruz. Curl istekleri sonrasında response değerlerinin ekrana yazdırılmaması için /dev/null değeri kullandım. Böylece ssh yapan kullanıcı hiçbir şekilde çıktı göremeyecektir.</p>
<p>Kendim Slack uygulamasını mobilde de kullandığımdan dolayı bildirimler cep telefonuma da direkt ulaşmaktadır.</p>
<p><img alt="" src="assets/images/slack-bildirimi.png" /></p>
<p>Hepsi bu kadar.</p>
            </section>

            <footer class="post-footer">
                <section>
                  <span class="post-meta">
                    Tags:                   </span>
                </section>

                <section class="share">
                    <h4>Share this post</h4>
                    <a class="icon-twitter" href="http://twitter.com/share?text=[SLACK] SSH Girişlerini Bildirim Olarak Almak&url=https://www.mustafa.com.tr/slack-ssh-girislerini-bildirim-olarak-almak.html"
                        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                        <span class="hidden">Twitter</span>
                        <span class='symbol'>circletwitterbird</span>
                    </a>
                    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.mustafa.com.tr/slack-ssh-girislerini-bildirim-olarak-almak.html"
                        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                        <span class="hidden">Facebook</span>
                        <span class='symbol'>circlefacebook</span>
                    </a>
                    <a class="icon-google-plus" href="https://plus.google.com/share?url=https://www.mustafa.com.tr/slack-ssh-girislerini-bildirim-olarak-almak.html"
                       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                        <span class="hidden">Google+</span>
                        <span class='symbol'>circlegoogleplus</span>
                    </a>
                </section>

            </footer>

            <div id="disqus_thread"></div>
            <script>
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//mustafaaltinkaynak.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        </article>
    </div>
</main>
                <footer class="site-footer">
                    <a class="subscribe icon-feed" href="https://www.mustafa.com.tr/feeds/all.rss"><span class="tooltip"><span class="symbol">blip</span></span></a>
                    <a class="subscribe icon-feed" href="https://www.mustafa.com.tr/archives.html"><span class="tooltip"><span class="symbol">star</span></span></a>
                    <div class="inner">
                         <section class="copyright">mustafaaltinkaynak &copy; 2017</section>
                    </div>
                </footer>

                <!-- Yandex.Metrika counter -->
                <script type="text/javascript">
                    (function (d, w, c) {
                        (w[c] = w[c] || []).push(function() {
                            try {
                                w.yaCounter39549065 = new Ya.Metrika({
                                    id:39549065,
                                    clickmap:true,
                                    trackLinks:true,
                                    accurateTrackBounce:true
                                });
                            } catch(e) { }
                        });

                        var n = d.getElementsByTagName("script")[0],
                            s = d.createElement("script"),
                            f = function () { n.parentNode.insertBefore(s, n); };
                        s.type = "text/javascript";
                        s.async = true;
                        s.src = "https://mc.yandex.ru/metrika/watch.js";

                        if (w.opera == "[object Opera]") {
                            d.addEventListener("DOMContentLoaded", f, false);
                        } else { f(); }
                    })(document, window, "yandex_metrika_callbacks");
                </script>
                <noscript><div><img src="https://mc.yandex.ru/watch/39549065" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
                <!-- /Yandex.Metrika counter -->


            </div>
        </div>
    </body>
</html>